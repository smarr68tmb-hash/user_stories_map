# üéØ –†–µ–∑—é–º–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ Backend (v2.0.0)

**–î–∞—Ç–∞:** 25 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ  
**–¢–µ—Å—Ç—ã:** ‚úÖ 9/9 –ø—Ä–æ—à–ª–∏

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π:

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| **–†–∞–∑–º–µ—Ä main.py** | 1116 —Å—Ç—Ä–æ–∫ | 90 —Å—Ç—Ä–æ–∫ | **-92%** |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤** | 1 –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π | 20 –º–æ–¥—É–ª—å–Ω—ã—Ö | –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| **–¢–µ—Å—Ç—ã** | 9 passed | 9 passed | ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |
| **–õ–∏–Ω—Ç–µ—Ä –æ—à–∏–±–∫–∏** | N/A | 0 | ‚úÖ –ß–∏—Å—Ç—ã–π –∫–æ–¥ |

---

## üèóÔ∏è –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ main.py                     # 90 —Å—Ç—Ä–æ–∫ (–±—ã–ª–æ 1116) - —Ç–æ–ª—å–∫–æ FastAPI app –∏ startup
‚îú‚îÄ‚îÄ config.py                   # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ dependencies.py             # FastAPI dependencies (get_current_user, etc.)
‚îÇ
‚îú‚îÄ‚îÄ models/                     # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py                # User, RefreshToken
‚îÇ   ‚îú‚îÄ‚îÄ project.py             # Project, Activity, UserTask, Release
‚îÇ   ‚îî‚îÄ‚îÄ story.py               # UserStory
‚îÇ
‚îú‚îÄ‚îÄ schemas/                    # Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ API
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ user.py                # UserCreate, UserResponse, Token
‚îÇ   ‚îú‚îÄ‚îÄ project.py             # ProjectResponse, RequirementsInput
‚îÇ   ‚îî‚îÄ‚îÄ story.py               # StoryCreate, StoryUpdate, StoryResponse
‚îÇ
‚îú‚îÄ‚îÄ services/                   # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (Service Layer)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py        # JWT, password hashing, authentication
‚îÇ   ‚îî‚îÄ‚îÄ ai_service.py          # AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ api/                        # FastAPI —Ä–æ—É—Ç—ã (API Layer)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                # /register, /token, /refresh, /logout, /me
‚îÇ   ‚îú‚îÄ‚îÄ projects.py            # /generate-map, /project/{id}, /projects
‚îÇ   ‚îú‚îÄ‚îÄ stories.py             # /story CRUD, /story/{id}/move
‚îÇ   ‚îî‚îÄ‚îÄ health.py              # /health, /ready
‚îÇ
‚îú‚îÄ‚îÄ utils/                      # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ database.py            # Database setup, SessionLocal, get_db
‚îÇ
‚îú‚îÄ‚îÄ main_old.py                # –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
‚îú‚îÄ‚îÄ test_main.py               # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (9/9 passed)
‚îî‚îÄ‚îÄ requirements.txt           # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

---

## üé® –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **Separation of Concerns (–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)**

#### –ë—ã–ª–æ (main.py):
- Models + Schemas + Business Logic + API Routes + Config = 1116 —Å—Ç—Ä–æ–∫

#### –°—Ç–∞–ª–æ:
- **Models** (—Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö)
- **Schemas** (—Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–∞—Ü–∏—è API)
- **Services** (—Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
- **API** (—Ç–æ–ª—å–∫–æ —Ä–æ—É—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤)
- **Config** (—Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

### 2. **Service Layer Pattern**

–í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ —Å–µ—Ä–≤–∏—Å—ã:

```python
# –î–æ: –ª–æ–≥–∏–∫–∞ –ø—Ä—è–º–æ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ
@app.post("/token")
def login(form_data):
    user = db.query(User).filter(User.email == form_data.username).first()
    if not user or not verify_password(...):
        raise HTTPException(...)
    # ... —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ ...
    
# –ü–æ—Å–ª–µ: —á–∏—Å—Ç—ã–π —Å–µ—Ä–≤–∏—Å —Å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ª–æ–≥–∏–∫–æ–π
from services.auth_service import authenticate_user, create_access_token

@router.post("/token")
def login(form_data):
    user = authenticate_user(db, form_data.username, form_data.password)
    if not user:
        raise HTTPException(...)
    return {"access_token": create_access_token(...)}
```

### 3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

```python
# config.py —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
class Settings:
    def _validate_settings(self):
        if self.ENVIRONMENT == "production":
            if self.JWT_SECRET_KEY == "your-secret-key-change-in-production":
                raise ValueError("JWT_SECRET_KEY must be set in production")
```

### 4. **–ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –ë–î**

–î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:

```python
class UserStory(Base):
    __table_args__ = (
        Index('idx_story_task_release', 'task_id', 'release_id'),
        Index('idx_story_position', 'task_id', 'release_id', 'position'),
    )
```

### 5. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ Dependencies**

```python
# dependencies.py - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
async def get_current_user(token: str = Depends(oauth2_scheme), ...):
    user_id = decode_access_token(token)
    return db.query(User).filter(User.id == user_id).first()
```

---

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. ‚úÖ **–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ–∞–π–ª** ‚Üí –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
2. ‚úÖ **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** ‚Üí Service layer —Å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –ª–æ–≥–∏–∫–æ–π
3. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ENV** ‚Üí –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
4. ‚úÖ **Inconsistent error handling** ‚Üí –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
5. ‚úÖ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤** ‚Üí –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
6. ‚úÖ **–£—Å—Ç–∞—Ä–µ–≤—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON** ‚Üí –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ ai_service

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ò–º–ø–æ—Ä—Ç—ã –∏–∑–º–µ–Ω–∏–ª–∏—Å—å:

#### –ë—ã–ª–æ:
```python
from main import app, get_db, SessionLocal
from main import User, Project, UserStory
```

#### –°—Ç–∞–ª–æ:
```python
from main import app
from utils.database import get_db, SessionLocal
from models import User, Project, UserStory
from schemas import UserCreate, ProjectResponse
from services.auth_service import authenticate_user
from services.ai_service import generate_ai_map
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞:

1. –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É –≤ `schemas/` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
2. –î–æ–±–∞–≤–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ `services/` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
3. –°–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ñ–∞–π–ª–µ `api/`
4. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç–µ—Ä –≤ `main.py`:

```python
from api import my_new_router
app.include_router(my_new_router.router)
```

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

```bash
cd backend
source venv/bin/activate
python main.py
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ. –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ deployment –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç:

```bash
pytest test_main.py -v
# 9 passed, 6 warnings in 3.65s
```

–¢–µ—Å—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

---

## üìö Best Practices –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

1. ‚úÖ **Clean Architecture** - —Å–ª–æ–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
2. ‚úÖ **DRY (Don't Repeat Yourself)** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
3. ‚úÖ **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã** - Single Responsibility –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
4. ‚úÖ **Dependency Injection** - FastAPI dependencies
5. ‚úÖ **Database Optimization** - –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
6. ‚úÖ **Error Handling** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
7. ‚úÖ **Configuration Management** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º:

1. **–î–æ–±–∞–≤–∏—Ç—å Unit —Ç–µ—Å—Ç—ã** –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ (auth_service, ai_service)
2. **–î–æ–±–∞–≤–∏—Ç—å Integration —Ç–µ—Å—Ç—ã** –¥–ª—è –ø–æ–ª–Ω—ã—Ö —Ñ–ª–æ—É
3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API** —á–µ—Ä–µ–∑ OpenAPI/Swagger descriptions
4. **–î–æ–±–∞–≤–∏—Ç—å Enum** –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –∏—Å—Ç–æ—Ä–∏–π
5. **Structured logging** (structlog)
6. **AsyncIO** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ I/O –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

1. **–°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞**: `/backend/main_old.py`
2. **–û—Ç–∫–∞—Ç–∏—Ç—å –º–æ–∂–Ω–æ**: `mv main.py main_refactored.py && mv main_old.py main.py`
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ! –ö–æ–¥ —Å—Ç–∞–ª:
- **–ë–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º** (–º–æ–¥—É–ª–∏ –≤–º–µ—Å—Ç–æ –º–æ–Ω–æ–ª–∏—Ç–∞)
- **–ë–æ–ª–µ–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º** (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏)
- **–ë–æ–ª–µ–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–º** (—Å–µ—Ä–≤–∏—Å—ã –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ)
- **–ë–æ–ª–µ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–º** (–ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏)

–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç, –Ω–∏–∫–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ –ø–æ—Ç–µ—Ä—è–Ω–æ! ‚úÖ

---

**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–ê–≤—Ç–æ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** AI Assistant (Claude Sonnet 4.5)  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** 25 –Ω–æ—è–±—Ä—è 2025

