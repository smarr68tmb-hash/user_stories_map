# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Gemini API

## üéâ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Google Gemini API —Å —É–º–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ª–∏–º–∏—Ç–∞–º–∏ –∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º –º–æ–¥–µ–ª–µ–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á.

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://makersuite.google.com/app/apikey
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```bash
GEMINI_API_KEY=AIzaYourKeyHere
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π

–í `.env` —Ñ–∞–π–ª–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á:

```bash
# –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (–ø–µ—Ä–≤—ã–π - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π)
AI_PROVIDER_PRIORITY=gemini,groq,perplexity,openai

# –ú–æ–¥–µ–ª–∏ Gemini –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
GEMINI_ENHANCEMENT_MODEL=gemini-2.0-flash-exp    # Stage 1: Enhancement (250 RPD)
GEMINI_GENERATION_MODEL=gemini-2.0-flash-exp     # Stage 2: Generation (50 RPD –¥–ª—è Pro)
GEMINI_ASSISTANT_MODEL=gemini-2.0-flash-exp      # AI Assistant (250 RPD)

# –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –î–û –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è)
GEMINI_PRO_LIMIT=45       # –ò–∑ 50 RPD
GEMINI_FLASH_LIMIT=230    # –ò–∑ 250 RPD
```

## üìä –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# Stage 1 (Enhancement): –±—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å
GEMINI_ENHANCEMENT_MODEL=gemini-2.0-flash-exp  # 250 RPD, –±—ã—Å—Ç—Ä–æ

# Stage 2 (Generation): –º–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å
GEMINI_GENERATION_MODEL=gemini-2.0-flash-exp   # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pro: gemini-2.5-pro
                                                # Pro: 50 RPD, –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ

# AI Assistant: –±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞
GEMINI_ASSISTANT_MODEL=gemini-2.0-flash-exp    # 250 RPD, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ Gemini

| –ú–æ–¥–µ–ª—å | RPD (–±–µ—Å–ø–ª–∞—Ç–Ω–æ) | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|--------|-----------------|------------|-------------|
| `gemini-2.0-flash-exp` | 250 | Enhancement, Assistant | –ë—ã—Å—Ç—Ä–∞—è, —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| `gemini-2.5-flash` | 250 | Enhancement, Assistant | –°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è Flash |
| `gemini-2.5-pro` | 50 | Generation (–∫–∞—Ä—Ç—ã) | –ú–æ—â–Ω–∞—è, –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ |
| `gemini-2.0-flash-thinking-exp` | ? | –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è | –£–ª—É—á—à–µ–Ω–Ω–æ–µ "–º—ã—à–ª–µ–Ω–∏–µ" |

## üîÑ –°–∏—Å—Ç–µ–º–∞ Fallback

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:
```
Gemini ‚Üí Groq ‚Üí Perplexity ‚Üí OpenAI
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç fallback

1. **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**: –ü—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É (45/50 –¥–ª—è Pro, 230/250 –¥–ª—è Flash) —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ü—Ä–∏ 429 (rate limit) –∏–ª–∏ 503 (unavailable) –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
3. **–£–º–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π**: –ö–∞–∂–¥—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

```
1. Enhancement (Stage 1):
   ‚Üí Gemini Flash (230/250) ‚Üí –¥–æ—Å—Ç—É–ø–µ–Ω
   ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini Flash

2. Generation (Stage 2):
   ‚Üí Gemini Pro (48/50) ‚Üí –±–ª–∏–∑–∫–æ –∫ –ª–∏–º–∏—Ç—É, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
   ‚Üí Groq llama-3.3-70b ‚Üí –¥–æ—Å—Ç—É–ø–µ–Ω
   ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Groq

3. AI Assistant:
   ‚Üí Gemini Flash (231/250) ‚Üí –¥–æ—Å—Ç—É–ø–µ–Ω
   ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini Flash
```

## üìà Rate Limiting

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API:

- –°—á–µ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –õ–∏–º–∏—Ç—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤ 00:00 UTC
- –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ (>2 –¥–Ω–µ–π) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è

### –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã

–í–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è 429 –æ—à–∏–±–∫–∏, —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ:

```python
GEMINI_PRO_LIMIT=45      # –ü–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –ø—Ä–∏ 45/50 –∑–∞–ø—Ä–æ—Å–æ–≤
GEMINI_FLASH_LIMIT=230   # –ü–µ—Ä–µ–∫–ª—é—á–∏–º—Å—è –ø—Ä–∏ 230/250 –∑–∞–ø—Ä–æ—Å–æ–≤
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
cd backend
source venv/bin/activate
python test_gemini_integration.py
```

### –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞

```
============================================================
–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï GEMINI API –ò–ù–¢–ï–ì–†–ê–¶–ò–ò
============================================================

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   ‚úì GEMINI_API_KEY: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   ‚úì Available providers: ['gemini', 'groq', 'perplexity']
   ...

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Gemini –∫–ª–∏–µ–Ω—Ç–∞
   ‚úì Gemini client initialized successfully

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Rate Limiter
   ‚úì Rate limiter test: Count = 1
   ‚úì Should skip provider: False

4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–µ–π
   ‚úì Enhancement model: gemini-2.0-flash-exp
   ‚úì Generation model: gemini-2.0-flash-exp
   ‚úì Assistant model: gemini-2.0-flash-exp

5. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ Gemini API
   ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏ gemini-2.0-flash-exp...
   ‚úì –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç Gemini API

============================================================
–†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–û–í
============================================================
Client Init          ‚úÖ PASSED
Rate Limiter         ‚úÖ PASSED
Model Selection      ‚úÖ PASSED
API Call             ‚úÖ PASSED
============================================================
üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò –£–°–ü–ï–®–ù–û!
============================================================
```

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

1. **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã**: 250 RPD –¥–ª—è Flash, 50 RPD –¥–ª—è Pro
2. **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ**: –û—Å–æ–±–µ–Ω–Ω–æ Pro –º–æ–¥–µ–ª–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback**: –ë–µ—Å—à–æ–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
4. **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –î–û –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞
5. **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –†–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á

## üîß Troubleshooting

### Gemini client not initialized

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–ª–∏–µ–Ω—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `GEMINI_API_KEY` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `AIza`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: `pip install google-generativeai`

### Rate limit errors (429)

**–ü—Ä–æ–±–ª–µ–º–∞**: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–º–µ–Ω—å—à–∏—Ç–µ –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã –≤ `.env`:
   ```bash
   GEMINI_PRO_LIMIT=40
   GEMINI_FLASH_LIMIT=220
   ```
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Groq, Perplexity, OpenAI)

### Content blocked

**–ü—Ä–æ–±–ª–µ–º–∞**: Gemini –±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç

**–†–µ—à–µ–Ω–∏–µ**:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ `BLOCK_NONE`
- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:

```
‚úÖ Initialized Gemini API client
Trying GEMINI with model gemini-2.0-flash-exp
‚úÖ Successfully got response from GEMINI
‚è© Skipping GEMINI - approaching rate limit
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∑—Ä–∞—á–Ω—ã - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
result = enhance_requirements(raw_text, redis_client)

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
map_data = generate_ai_map(requirements_text, redis_client)

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
improved = ai_improve_story_content(story_data, user_prompt, action)
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Gemini API Documentation](https://ai.google.dev/docs)
- [Get API Key](https://makersuite.google.com/app/apikey)
- [Rate Limits](https://ai.google.dev/pricing)
